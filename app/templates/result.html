{% extends "base.html" %}

{% block title %}Resume Analysis â€” {{ analysis.score }}/100{% endblock %}

{% block content %}

{# Determine score tier for colours #}
{% if analysis.score >= 80 %}
  {% set ring_color   = "#10b981" %}{# emerald-500 #}
  {% set badge_class  = "bg-emerald-50 text-emerald-700 ring-emerald-200" %}
  {% set tier_label   = "Strong Match" %}
{% elif analysis.score >= 65 %}
  {% set ring_color   = "#6366f1" %}{# indigo-500 #}
  {% set badge_class  = "bg-indigo-50 text-indigo-700 ring-indigo-200" %}
  {% set tier_label   = "Good Match" %}
{% elif analysis.score >= 45 %}
  {% set ring_color   = "#f59e0b" %}{# amber-500 #}
  {% set badge_class  = "bg-amber-50 text-amber-700 ring-amber-200" %}
  {% set tier_label   = "Partial Match" %}
{% else %}
  {% set ring_color   = "#ef4444" %}{# red-500 #}
  {% set badge_class  = "bg-red-50 text-red-700 ring-red-200" %}
  {% set tier_label   = "Weak Match" %}
{% endif %}

{# SVG circle math #}
{% set radius      = 70 %}
{% set circumference = 2 * 3.14159 * radius %}
{% set dashoffset  = circumference * (1 - analysis.score / 100) %}

<!-- Back link -->
<div class="mb-6">
  <a
    href="/"
    class="inline-flex items-center gap-1.5 text-sm text-slate-500 hover:text-indigo-600 transition-colors"
  >
    <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"/>
    </svg>
    Analyze another resume
  </a>
</div>

<!-- Page heading -->
<h1 class="text-3xl font-bold text-gray-900 mb-8">Analysis Results</h1>

<!-- Score card -->
<div class="bg-white rounded-2xl border border-slate-200 shadow-sm p-8 mb-6 flex flex-col sm:flex-row items-center gap-8">

  <!-- Circular score dial -->
  <div class="relative shrink-0 w-44 h-44">
    <svg class="w-44 h-44 -rotate-90" viewBox="0 0 160 160">
      <!-- Track -->
      <circle
        cx="80" cy="80" r="{{ radius }}"
        fill="none"
        stroke="#e2e8f0"
        stroke-width="14"
      />
      <!-- Progress arc -->
      <circle
        cx="80" cy="80" r="{{ radius }}"
        fill="none"
        stroke="{{ ring_color }}"
        stroke-width="14"
        stroke-linecap="round"
        stroke-dasharray="{{ circumference | round(2) }}"
        stroke-dashoffset="{{ dashoffset | round(2) }}"
      />
    </svg>
    <!-- Centred text -->
    <div class="absolute inset-0 flex flex-col items-center justify-center">
      <span class="text-5xl font-bold text-gray-900 leading-none">{{ analysis.score }}</span>
      <span class="text-sm text-slate-400 mt-1">/ 100</span>
    </div>
  </div>

  <!-- Score details -->
  <div class="flex flex-col gap-3 text-center sm:text-left">
    <span
      class="self-center sm:self-start inline-flex items-center rounded-full px-3 py-1 text-sm font-medium ring-1 ring-inset {{ badge_class }}"
    >
      {{ tier_label }}
    </span>

    <div>
      <p class="text-sm text-slate-500">Resume</p>
      <p class="font-medium text-gray-800 truncate max-w-xs">{{ analysis.resume_filename }}</p>
    </div>

    <div>
      <p class="text-sm text-slate-500">Analyzed</p>
      <p class="font-medium text-gray-800">
        {{ analysis.created_at.strftime("%B %d, %Y at %I:%M %p") }}
      </p>
    </div>
  </div>
</div>

<!-- Summary -->
<div class="bg-white rounded-2xl border border-slate-200 shadow-sm p-6 mb-6">
  <h2 class="text-base font-semibold text-gray-900 mb-3 flex items-center gap-2">
    <svg class="h-5 w-5 text-slate-400" fill="none" viewBox="0 0 24 24" stroke-width="1.8" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round"
        d="M7.5 8.25h9m-9 3H12m-9.75 1.51c0 1.6 1.123 2.994 2.707 3.227 1.129.166 2.27.293 3.423.379.35.026.67.21.865.501L12 21l2.755-4.133a1.14 1.14 0 0 1 .865-.501 48.172 48.172 0 0 0 3.423-.379c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0 0 12 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018Z"/>
    </svg>
    Overall Assessment
  </h2>
  <p class="text-sm text-slate-700 leading-relaxed">{{ analysis.summary }}</p>
</div>

<!-- Strengths + Weaknesses grid -->
<div class="grid grid-cols-1 sm:grid-cols-2 gap-6 mb-8">

  <!-- Strengths -->
  <div class="bg-white rounded-2xl border border-slate-200 shadow-sm p-6">
    <h2 class="text-base font-semibold text-gray-900 mb-4 flex items-center gap-2">
      <svg class="h-5 w-5 text-emerald-500" fill="none" viewBox="0 0 24 24" stroke-width="1.8" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round"
          d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/>
      </svg>
      Strengths
    </h2>
    {% if strengths %}
    <ul class="space-y-3">
      {% for item in strengths %}
      <li class="flex items-start gap-2.5">
        <span class="mt-0.5 flex h-5 w-5 shrink-0 items-center justify-center rounded-full bg-emerald-100">
          <svg class="h-3 w-3 text-emerald-600" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M16.704 4.153a.75.75 0 0 1 .143 1.052l-8 10.5a.75.75 0 0 1-1.127.075l-4.5-4.5a.75.75 0 0 1 1.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 0 1 1.05-.143Z" clip-rule="evenodd"/>
          </svg>
        </span>
        <span class="text-sm text-slate-700">{{ item }}</span>
      </li>
      {% endfor %}
    </ul>
    {% else %}
    <p class="text-sm text-slate-400 italic">No strengths identified.</p>
    {% endif %}
  </div>

  <!-- Weaknesses / Areas for improvement -->
  <div class="bg-white rounded-2xl border border-slate-200 shadow-sm p-6">
    <h2 class="text-base font-semibold text-gray-900 mb-4 flex items-center gap-2">
      <svg class="h-5 w-5 text-amber-500" fill="none" viewBox="0 0 24 24" stroke-width="1.8" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round"
          d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"/>
      </svg>
      Areas to Improve
    </h2>
    {% if weaknesses %}
    <ul class="space-y-3">
      {% for item in weaknesses %}
      <li class="flex items-start gap-2.5">
        <span class="mt-0.5 flex h-5 w-5 shrink-0 items-center justify-center rounded-full bg-amber-100">
          <svg class="h-3 w-3 text-amber-600" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M8.485 2.495c.673-1.167 2.357-1.167 3.03 0l6.28 10.875c.673 1.167-.17 2.625-1.516 2.625H3.72c-1.347 0-2.189-1.458-1.515-2.625L8.485 2.495ZM10 5a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 10 5Zm0 9a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z" clip-rule="evenodd"/>
          </svg>
        </span>
        <span class="text-sm text-slate-700">{{ item }}</span>
      </li>
      {% endfor %}
    </ul>
    {% else %}
    <p class="text-sm text-slate-400 italic">No improvement areas identified.</p>
    {% endif %}
  </div>

</div>

<!-- Shareable link -->
<div class="rounded-xl border border-slate-200 bg-white p-4 flex flex-col sm:flex-row items-start sm:items-center gap-3">
  <div class="flex-1 min-w-0">
    <p class="text-xs font-medium text-slate-500 mb-1">Shareable link</p>
    <p
      id="share-url"
      class="text-sm text-indigo-600 truncate font-mono select-all"
    >{{ request.url }}</p>
  </div>
  <button
    x-data="{ copied: false }"
    @click="
      navigator.clipboard.writeText(document.getElementById('share-url').textContent.trim());
      copied = true;
      setTimeout(() => copied = false, 2000);
    "
    class="shrink-0 inline-flex items-center gap-1.5 rounded-lg border border-slate-200 bg-slate-50 px-3 py-1.5 text-xs font-medium text-slate-600 hover:bg-slate-100 transition-colors"
  >
    <svg x-show="!copied" class="h-3.5 w-3.5" fill="none" viewBox="0 0 24 24" stroke-width="1.8" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round"
        d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"/>
    </svg>
    <svg x-show="copied" x-cloak class="h-3.5 w-3.5 text-emerald-500" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5"/>
    </svg>
    <span x-text="copied ? 'Copied!' : 'Copy link'">Copy link</span>
  </button>
</div>

<!-- Buy Me a Coffee modal -->
<div
  x-data="{ showModal: false }"
  x-init="setTimeout(() => showModal = true, 2000)"
>
  <!-- Backdrop -->
  <div
    x-show="showModal"
    x-cloak
    x-transition:enter="transition ease-out duration-200"
    x-transition:enter-start="opacity-0"
    x-transition:enter-end="opacity-100"
    x-transition:leave="transition ease-in duration-150"
    x-transition:leave-start="opacity-100"
    x-transition:leave-end="opacity-0"
    class="fixed inset-0 z-40 bg-black/40"
    @click="showModal = false"
  ></div>

  <!-- Modal panel -->
  <div
    x-show="showModal"
    x-cloak
    x-transition:enter="transition ease-out duration-200"
    x-transition:enter-start="opacity-0 scale-95"
    x-transition:enter-end="opacity-100 scale-100"
    x-transition:leave="transition ease-in duration-150"
    x-transition:leave-start="opacity-100 scale-100"
    x-transition:leave-end="opacity-0 scale-95"
    class="fixed inset-0 z-50 flex items-center justify-center p-4"
  >
    <div class="w-full max-w-sm rounded-2xl bg-white shadow-xl p-8 text-center" @click.outside="showModal = false">
      <span class="text-5xl block mb-4" aria-hidden="true">&#9749;</span>
      <h2 class="text-xl font-bold text-gray-900 mb-2">Glad we could help!</h2>
      <p class="text-sm text-slate-500 mb-6">
        If ResuMatch helped you tailor your resume, consider buying me a coffee to keep it running.
      </p>
      <a
        href="https://buymeacoffee.com/mark.p"
        target="_blank"
        rel="noopener noreferrer"
        class="block w-full rounded-xl bg-amber-400 px-6 py-3 text-sm font-semibold text-amber-950 hover:bg-amber-300 transition-colors mb-3"
      >
        Buy Me a Coffee
      </a>
      <button
        @click="showModal = false"
        class="text-sm text-slate-400 hover:text-slate-600 transition-colors"
      >
        No thanks
      </button>
    </div>
  </div>
</div>

{% endblock %}
